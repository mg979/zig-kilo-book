<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The welcome message - Build your own text editor in Zig</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/css/code-blocks.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Build your own text editor in Zig</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-welcome-message"><a class="header" href="#the-welcome-message">The welcome message</a></h1>
<p>The original <code>kilo</code> editor would print a welcome message when the program is
started without arguments, which results in a new empty, unnamed buffer to be
created.</p>
<p>We also want it because it's cool and reminds us (or at least me) of vim.</p>
<p>New fields in <code>Editor</code>:</p>
<div class="code-title">Editor.zig</div>
<pre><code class="language-zig">/// String to be displayed when the editor is started without loading a file
welcome_msg: t.Chars,

/// Becomes false after the first screen redraw
just_started: bool,
</code></pre>
<p>Initialize in <code>init()</code>.</p>
<div class="code-title">Editor.zig: init()</div>
<pre><code class="language-zig">        .welcome_msg = try t.Chars.initCapacity(allocator, 0),
        .just_started = true,
</code></pre>
<p>Deinitialize in <code>deinit()</code>:</p>
<div class="code-title">Editor.zig: deinit()</div>
<pre><code class="language-zig">    e.welcome_msg.deinit(e.alc);
</code></pre>
<p>When, how, and where do we want the welcome message to appear?</p>
<ul>
<li>
<p>we generate it when the argument for <code>startUp()</code> is <code>null</code>, which means
there's no file to open</p>
</li>
<li>
<p>we want to generate it dynamically because the message should be centered on
screen, and we can assess that only at runtime</p>
</li>
<li>
<p>we render the message in <code>drawRows()</code></p>
</li>
</ul>
<h3 id="a-module-for-messages"><a class="header" href="#a-module-for-messages">A module for messages</a></h3>
<p>When generating the message, we must fetch the base string from somewhere.
It will be the same for other text constants and messages that we'll use in the
editor in the future. So we create a <code>message</code> module and we import it in
Editor:</p>
<pre><code class="language-zig">const message = @import("message.zig");
</code></pre>
<p>This module for now will look like this:</p>
<div class="code-title">message.zig</div>
<pre><code class="language-zig">//! Module that holds various strings for the message area, either status or
//! error messages, or prompts.

const std = @import("std");
const opt = @import("option.zig");

const status_messages = .{
    .{ "welcome", "Kilo editor -- version " ++ opt.version_str },
};

pub const status = std.StaticStringMap([]const u8).initComptime(status_messages);
</code></pre>
<p>We also create a <code>version_str</code> in our <code>option</code> module, so that it contains the
current version number, as a string:</p>
<div class="code-title">option.zig</div>
<pre><code class="language-zig">pub const version_str = "0.1";
</code></pre>
<p>The <code>StaticStringMap</code> is created at compile time (see how it's initialized),
and will be accessed in Editor with <code>message.status.get()</code>, that returns an
<em>optional value</em> which is <code>null</code> if the <em>key</em> couldn't be found.</p>
<p><em>Keys</em> of <code>StaticStringMap</code> will always be strings, but <em>values</em> can be of any
type. In our case they are also strings (<code>[]const u8</code>).</p>
<h3 id="generate-the-message"><a class="header" href="#generate-the-message">Generate the message</a></h3>
<p>We had a commented placeholder in <code>startUp()</code>, so we must replace it with the
actual function call.</p>
<div class="code-title">Editor.zig: startUp()</div>
<div class="code-diff-removed">
<pre><code class="language-zig">    else {
        // we generate the welcome message
    }
</code></pre>
</div>
<pre><code class="language-zig">    else {
        try e.generateWelcome();
    }
</code></pre>
<p>The function to generate the message is:</p>
<div class="code-title">Editor.zig</div>
<pre><code class="language-zig">/// Generate the welcome message.
fn generateWelcome(e: *Editor) !void {
    // code to come...
}
</code></pre>
<p>The line with the welcome message starts with a <code>~</code>, because we're in an empty
buffer.</p>
<p>The length of the message must be limited to the screen columns - 1, because of
the <code>~</code> which we just appended.</p>
<div class="code-title">Editor.zig: generateWelcome()</div>
<pre><code class="language-zig">    try e.welcome_msg.append(e.alc, '~');

    var msg = message.status.get("welcome").?;
    if (msg.len &gt;= e.screen.cols) {
        msg = msg[0 .. e.screen.cols - 1];
    }
</code></pre>
<p>The padding will be inserted before the message.</p>
<div class="code-title">Editor.zig: generateWelcome()</div>
<pre><code class="language-zig">    const padding: usize = (e.screen.cols - msg.len) / 2;

    try e.welcome_msg.appendNTimes(e.alc, ' ', padding);
    try e.welcome_msg.appendSlice(e.alc, msg);
</code></pre>
<h3 id="render-the-message"><a class="header" href="#render-the-message">Render the message</a></h3>
<p>In <code>drawRows()</code>, all we have to do is replace the <code>if</code> branch for when the row
is past the end of the buffer, with this:</p>
<div class="code-title">Editor.zig: drawRows()</div>
<div class="code-diff-removed">
<pre><code class="language-zig">        // past buffer content
        if (ix &gt;= rows.len) {
            try e.toSurface('~');
</code></pre>
</div>
<pre><code class="language-zig">        // past buffer content
        if (ix &gt;= rows.len) {
            if (e.just_started
                and e.buffer.filename == null
                and e.buffer.rows.items.len == 0
                and y == e.screen.rows / 3) {
                try e.toSurface(e.welcome_msg.items);
            }
            else {
                try e.toSurface('~');
            }
</code></pre>
<p>We append it to the surface if the buffer is empty, doesn't even have a name,
and current row is at about 1/3 of the height of the screen.</p>
<p>Remember to set <code>just_started</code> to <code>false</code> at the bottom of <code>refreshScreen()</code>,
if you didn't already.</p>
<div class="code-title">Editor.zig: refreshScreen()</div>
<div class="code-diff-added-top">
<pre><code class="language-zig">    e.just_started = false;
</code></pre>
</div>
<pre><code class="language-zig">    try linux.write(e.surface.items);
</code></pre>
<p>We also set <code>just_started</code> to <code>false</code> so that our welcome message won't be
printed again.</p>
<p>Compile and run with</p>
<pre><code>./kilo
</code></pre>
<p>to see an empty buffer and the welcome message. You can try to run again with
a narrower terminal window, to verify that the message and the statusline are
displayed correctly.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../draw/status_msg.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../viewer/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../draw/status_msg.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../viewer/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
